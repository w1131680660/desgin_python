webpackJsonp([83],{"7Ujz":function(e,t,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=a("BO1k"),o=a.n(i),n={name:"",props:{},components:{},data:function(){return{menuPlatFormList:[],menuCountryList:[],menuSiteList:[],showCountryList:[],showSiteList:[],lastSiteList:[],performanceList:[],newPerList:[],noExamineList:[],targetList:[],checkedPlatform:"",checkedCountry:"",checkedSite:"",today:"",lastDay:"",yesterday:"",performanceForm:[],addTargetDialogVisible:!1,addTargetForm:{checkedData:"",checkedSituation:"",targetName:"",enlName:""},editTodayDialogVisible:!1,editTodayForm:{},dataType:["数字","百分比"],situation:["上升","下降","和以前不一致"],formRules:{targetName:[{required:!0,message:"请输入指标名称",trigger:"blur"}],checkedData:[{required:!0,message:"请选择数据类型",trigger:"change"}],checkedSituation:[{required:!0,message:"请选择情况",trigger:"change"}],enlName:[{validator:function(e,t,a){/^[a-zA-Z]+$/.test(t)?a():a("英文名必须全部是英文字母")},trigger:"blur"}],checkList:[{type:"array",required:!0,message:"请至少选择一个指标",trigger:"change"}],checkIndex:[{required:!0,message:"请选择指标",trigger:"change"}]},value1:"",examineDialogVisible:!1,examineForm:{checkIndex:""}}},computed:{},watch:{},methods:{getMenuList:function(){var e=this;this.$api.getMenuList().then(function(t){e.menuPlatFormList=t.data.data1,e.menuCountryList=t.data.data2,e.menuSiteList=t.data.data3,e.showCountryList=e.menuCountryList[0],e.showSiteList=e.menuSiteList[0],e.lastSiteList=e.showSiteList[0],e.checkedPlatform=e.menuPlatFormList[0],e.checkedCountry=e.showCountryList[0],e.checkedSite=e.lastSiteList[0],e.thirdClick(e.checkedPlatform,e.checkedCountry,e.checkedSite)})},getNoExamineList:function(){var e=this;this.$api.getNoExamineList().then(function(t){console.log(t),e.noExamineList=t.data.data})},onceClick:function(e){this.showCountryList=[],this.showSiteList=[],this.showCountryList=this.menuCountryList[e],this.showSiteList=this.menuSiteList[e]},secondClick:function(e){this.lastSiteList=[],this.lastSiteList=this.showSiteList[e]},thirdClick:function(e,t,a){var i=this;for(var n in this.editTodayForm)this.editTodayForm[n]="";this.performanceList=[],this.$api.queryPerformence(e,t,a).then(function(e){console.log(e),i.today=new Date;var t=i.today.getMonth()+1<10?"0"+(i.today.getMonth()+1):i.today.getMonth()+1,a=i.today.getDate()<10?"0"+i.today.getDate():i.today.getDate();i.today=i.today.getFullYear()+"-"+t+"-"+a,i.yesterday=new Date,i.yesterday.setTime(i.yesterday.getTime()-864e5);var n=i.yesterday.getMonth()+1<10?"0"+(i.yesterday.getMonth()+1):i.yesterday.getMonth()+1,s=i.yesterday.getDate()<10?"0"+i.yesterday.getDate():i.yesterday.getDate();for(var r in i.yesterday=i.yesterday.getFullYear()+"-"+n+"-"+s,console.log("res.data.data",e.data.data),i.performanceList=e.data.data.length>0?e.data.data.reverse():[],console.log("打印之后"),i.targetList=e.data.fields||[],i.targetList)i.editTodayForm[i.targetList[r][1]+r]="";if(0!=i.performanceList.length&&(i.lastDay=i.performanceList[i.performanceList.length-1][4],i.lastDay==i.today)){console.log("一样");var l=i.$utils.deepClone(i.performanceList),d=!0,c=!1,m=void 0;try{for(var u,h=o()(l);!(d=(u=h.next()).done);d=!0){u.value.splice(0,5)}}catch(e){c=!0,m=e}finally{try{!d&&h.return&&h.return()}finally{if(c)throw m}}for(var f in i.targetList)if(null!==l[l.length-1][f]){i.editTodayForm[i.targetList[f][1]+f]=l[l.length-1][f]}else i.editTodayForm[i.targetList[f][1]+f]="";for(var g in i.editTodayForm)"undefined"==i.editTodayForm[g]&&(i.editTodayForm[g]="")}}),this.checkedPlatform=e,this.checkedCountry=t,this.checkedSite=a},selectChange:function(e){},addTarget:function(){this.addTargetDialogVisible=!0},addTargetConfirm:function(){var e=this;this.$refs.addTargetRef.validate(function(t){if(t){var a=new FormData;a.append("index_name",e.addTargetForm.targetName),a.append("english_name",e.addTargetForm.enlName),a.append("index_type",e.addTargetForm.checkedData),a.append("alert",e.addTargetForm.checkedSituation),e.$api.addTarget(a).then(function(t){e.$message.success("新增指标成功"),e.thirdClick(e.checkedPlatform,e.checkedCountry,e.checkedSite),e.getNoExamineList(),e.addTargetDialogVisible=!1})}})},editToday:function(){this.editTodayForm={},this.editTodayDialogVisible=!0},editTodayConfirm:function(){var e=this,t=new FormData;for(var a in t.append("platform",this.checkedPlatform),t.append("country",this.checkedCountry),t.append("site",this.checkedSite),this.targetList){var i=this.targetList[a][1]+a;t.append(this.targetList[a][1],this.editTodayForm[i])}this.$api.editTarget(t).then(function(t){e.thirdClick(e.checkedPlatform,e.checkedCountry,e.checkedSite)}),this.editTodayDialogVisible=!1},examine:function(){this.examineDialogVisible=!0},examineConfirm:function(){var e=this;this.$refs.examineRef.validate(function(t){t&&e.$api.examine(e.examineForm.checkIndex,"审核通过").then(function(t){e.$message.success("审核通过"),e.thirdClick(e.checkedPlatform,e.checkedCountry,e.checkedSite),e.getNoExamineList(),e.examineDialogVisible=!1})})},examineNoConfirm:function(){var e=this;this.$refs.examineRef.validate(function(t){t&&e.$api.examine(e.examineForm.checkIndex,"审核不通过").then(function(t){e.$message.success("审核不通过"),e.getNoExamineList(),e.examineDialogVisible=!1})})},addTargetClose:function(){this.$refs.addTargetRef.resetFields()},editTodayClose:function(){this.$refs.editTodayRef.resetFields()},examineClose:function(){this.$refs.examineRef.resetFields()},inputChange:function(e){this.$forceUpdate()},updateChange:function(e){var t=this;console.log(e);var a=new FormData;for(var i in a.append("platform",this.performanceList[e][1]),a.append("country",this.performanceList[e][2]),a.append("site",this.performanceList[e][3]),this.targetList)a.append(this.targetList[i][1],this.performanceList[e][i-0+5]);a.append("update_date",this.performanceList[e][4]),this.$api.editTodayYester(a).then(function(e){console.log(e),t.thirdClick(t.checkedPlatform,t.checkedCountry,t.checkedSite)})},getPercent:function(e){return"百分比"===e[2]?e[0]+"%":e[0]}},created:function(){this.getMenuList(),this.getNoExamineList()},mounted:function(){}},s={render:function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{attrs:{id:"ipi-board"}},[a("div",{staticClass:"left"},[e._m(0),e._v(" "),a("div",{staticClass:"left-content"},[a("h3",[e._v("请选择店铺")]),e._v(" "),a("el-menu",{staticClass:"el-menu-vertical-demo",attrs:{"default-active":"0-0-0","unique-opened":""}},e._l(e.menuPlatFormList,function(t,i){return a("el-submenu",{key:i,attrs:{index:i+""}},[a("template",{slot:"title"},[a("span",{staticStyle:{display:"inline-block",width:"100%"},on:{click:function(t){return e.onceClick(i)}}},[e._v(e._s(t))])]),e._v(" "),e._l(e.showCountryList,function(o,n){return a("el-submenu",{key:n,attrs:{index:i+"-"+n}},[a("template",{slot:"title"},[a("span",{staticStyle:{display:"inline-block",width:"100%"},on:{click:function(t){return e.secondClick(n)}}},[e._v(e._s(o))])]),e._v(" "),e._l(e.lastSiteList,function(s,r){return a("el-menu-item",{key:r,attrs:{index:i+"-"+n+"-"+r},on:{click:function(a){return e.thirdClick(t,o,s)}}},[a("span",[e._v(e._s(s))])])})],2)})],2)}),1)],1)]),e._v(" "),a("div",{staticClass:"right"},[a("div",{staticClass:"top"},[a("h2",[e._v("最近绩效指标")]),e._v(" "),a("div",{staticClass:"position"},[a("span",{staticClass:"position-title"},[e._v("\n          站点：\n          "),a("span",[e._v(e._s(e.checkedSite))])]),e._v(" "),a("span",{staticClass:"position-title"},[e._v("\n          国家：\n          "),a("span",[e._v(e._s(e.checkedCountry))])])])]),e._v(" "),a("div",{staticClass:"button"},[a("el-button",{attrs:{type:"primary",size:"mini"},on:{click:e.editToday}},[e._v("新增当日指标数据")]),e._v(" "),a("el-button",{attrs:{type:"primary",size:"mini"},on:{click:e.addTarget}},[e._v("增加新的指标")]),e._v(" "),a("el-button",{attrs:{type:"primary",size:"mini"},on:{click:e.examine}},[e._v("审核指标")]),e._v(" "),a("span",{staticStyle:{"font-size":"0.8rem",float:"right"}},[e._v("ps:编辑指标不需要填写单位哦！")])],1),e._v(" "),a("div",{staticClass:"table"},[a("el-table",{staticStyle:{width:"100%"},attrs:{data:e.performanceList,border:""}},[a("el-table-column",{attrs:{type:"index",label:"序号",width:"60"}}),e._v(" "),a("el-table-column",{attrs:{prop:"4",label:"时间"}}),e._v(" "),e._l(e.targetList,function(t,i){return a("el-table-column",{key:i,attrs:{prop:i+5+"",label:e.getPercent(t)},scopedSlots:e._u([{key:"default",fn:function(t){return[t.row[4]!=e.today&&t.row[4]!=e.yesterday?a("div",["undefined"!=t.row[i+5]?a("span",[e._v(e._s(t.row[i+5]))]):a("span")]):a("div",[a("input",{directives:[{name:"model",rawName:"v-model",value:t.row[i+5],expression:"scope.row[index + 5]"}],attrs:{type:"number"},domProps:{value:t.row[i+5]},on:{change:function(a){return e.updateChange(t.$index)},input:function(a){a.target.composing||e.$set(t.row,i+5,a.target.value)}}})])]}}],null,!0)})})],2)],1)]),e._v(" "),a("el-dialog",{attrs:{title:"增加新的指标",visible:e.addTargetDialogVisible,width:"30%",center:"","close-on-click-modal":!1,"close-on-press-escape":!1},on:{"update:visible":function(t){e.addTargetDialogVisible=t},close:e.addTargetClose}},[a("el-form",{ref:"addTargetRef",attrs:{model:e.addTargetForm,rules:e.formRules,"label-width":"120px"}},[a("el-form-item",{attrs:{label:"指标名称",prop:"targetName"}},[a("el-input",{model:{value:e.addTargetForm.targetName,callback:function(t){e.$set(e.addTargetForm,"targetName",t)},expression:"addTargetForm.targetName"}})],1),e._v(" "),a("el-form-item",{attrs:{label:"指标英文名称",prop:"enlName"}},[a("el-input",{model:{value:e.addTargetForm.enlName,callback:function(t){e.$set(e.addTargetForm,"enlName",t)},expression:"addTargetForm.enlName"}})],1),e._v(" "),a("el-form-item",{attrs:{label:"数据类型",prop:"checkedData"}},[a("el-select",{attrs:{placeholder:"请选择"},model:{value:e.addTargetForm.checkedData,callback:function(t){e.$set(e.addTargetForm,"checkedData",t)},expression:"addTargetForm.checkedData"}},e._l(e.dataType,function(e,t){return a("el-option",{key:t,attrs:{label:e,value:e}})}),1)],1),e._v(" "),a("el-form-item",{attrs:{label:"在什么情况下给主管发工单",prop:"checkedSituation"}},[a("el-select",{attrs:{placeholder:"请选择"},model:{value:e.addTargetForm.checkedSituation,callback:function(t){e.$set(e.addTargetForm,"checkedSituation",t)},expression:"addTargetForm.checkedSituation"}},e._l(e.situation,function(e,t){return a("el-option",{key:t,attrs:{label:e,value:e}})}),1)],1)],1),e._v(" "),a("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[a("el-button",{on:{click:function(t){e.addTargetDialogVisible=!1}}},[e._v("取 消")]),e._v(" "),a("el-button",{attrs:{type:"primary"},on:{click:e.addTargetConfirm}},[e._v("确 定")])],1)],1),e._v(" "),a("el-dialog",{staticClass:"edit-today-dialog",attrs:{visible:e.editTodayDialogVisible,width:"30%",center:"","close-on-click-modal":!1,"close-on-press-escape":!1},on:{"update:visible":function(t){e.editTodayDialogVisible=t},close:e.editTodayClose}},[a("el-form",{ref:"editTodayRef",attrs:{model:e.editTodayForm,"label-width":"120px"}},e._l(e.targetList,function(t,i){return a("el-form-item",{key:i,attrs:{label:t[0],prop:t[1]+i}},[a("el-input",{attrs:{size:"small"},on:{input:e.inputChange},model:{value:e.editTodayForm[t[1]+i],callback:function(a){e.$set(e.editTodayForm,t[1]+i,a)},expression:"editTodayForm[item[1] + index]"}})],1)}),1),e._v(" "),a("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[a("el-button",{on:{click:function(t){e.editTodayDialogVisible=!1}}},[e._v("取 消")]),e._v(" "),a("el-button",{attrs:{type:"primary"},on:{click:e.editTodayConfirm}},[e._v("确 定")])],1)],1),e._v(" "),a("el-dialog",{attrs:{visible:e.examineDialogVisible,width:"30%",center:"","close-on-click-modal":!1,"close-on-press-escape":!1},on:{"update:visible":function(t){e.examineDialogVisible=t},close:e.examineClose}},[a("el-form",{ref:"examineRef",attrs:{model:e.examineForm,"label-width":"140px",rules:e.formRules}},[a("el-form-item",{attrs:{label:"未审核的指标：",prop:"checkIndex"}},[e.noExamineList.length>0?a("el-radio-group",{model:{value:e.examineForm.checkIndex,callback:function(t){e.$set(e.examineForm,"checkIndex",t)},expression:"examineForm.checkIndex"}},e._l(e.noExamineList,function(t,i){return a("el-radio",{key:i,attrs:{label:t[0]}},[e._v(e._s(t[1]))])}),1):a("span",[e._v("暂无未审核的指标")])],1)],1),e._v(" "),e.noExamineList.length>0?a("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[a("el-button",{on:{click:e.examineNoConfirm}},[e._v("审核不通过")]),e._v(" "),a("el-button",{attrs:{type:"primary"},on:{click:e.examineConfirm}},[e._v("审核通过")])],1):e._e()],1)],1)},staticRenderFns:[function(){var e=this.$createElement,t=this._self._c||e;return t("div",{staticClass:"title"},[t("h2",{staticStyle:{"text-align":"center"}},[this._v("店铺绩效")])])}]};var r=a("VU/8")(n,s,!1,function(e){a("TPQz")},"data-v-606fff7c",null);t.default=r.exports},TPQz:function(e,t){}});
//# sourceMappingURL=83.1daea997a075c5ead37e.js.map
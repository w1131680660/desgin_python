webpackJsonp([34],{DfM1:function(t,e){},PWtu:function(t,e,a){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=a("pFYg"),n=a.n(i),s=a("fZjL"),l=a.n(s),o={name:"",props:{},components:{},data:function(){return{FirstInitSpu:!1,drawerVisible:!1,checkedSku:"",isShowSku:!1,receptionUrl:"",tableOne:{width:"",width1:"",width2:""},tableTwo:{width:""},uploadFlag:!1,dialogVisible:!1,dialogVisible1:!1,GuiPriSupForm:{date:"",auto_ad_cost:"",automatic_guidance:"",manual_guidance:"",no_auto_ad_cost:"",cost_rate:""},openCountryFlag:!1,loading:!1,date:"",table2_lastObj:{},submitYet:!1,disableOpt:{disabledDate:function(t){return t.getTime()>new Date}},yesterday_remark:"",rules:{automatic_guidance:[{message:"请输入数字",trigger:"blur",pattern:/(^\d+$)|(^\d+\.\d+$)/}],manual_guidance:[{message:"请输入数字",trigger:"blur",pattern:/(^\d+$)|(^\d+\.\d+$)/}]},GuidePriceSupRules:{date:[{required:!0,message:"请选择时间",trigger:"blur"}],sys_automatic_guidance:[{message:"请输入数字",trigger:"blur",pattern:/(^\d+$)|(^\d+\.\d+$)/}],auto_ad_cost:[{message:"请输入数字",trigger:"blur",pattern:/(^\d+$)|(^\d+\.\d+$)/}],sys_manual_guidance:[{message:"请输入数字",trigger:"blur",pattern:/(^\d+$)|(^\d+\.\d+$)/}],no_auto_ad_cost:[{message:"请输入数字",trigger:"blur",pattern:/(^\d+$)|(^\d+\.\d+$)/}]},rulesUL:{date:[{required:!0,message:"请选择时间",trigger:"blur"}],ranking:[{required:!0,message:"请输入大类排名",trigger:"blur"},{message:"请输入数字",trigger:"blur",pattern:/(^\d+$)|(^\d+\.\d+$)/}],small_rank:[{required:!0,message:"请输入小类排名",trigger:"blur"},{message:"请输入数字",trigger:"blur",pattern:/(^\d+$)|(^\d+\.\d+$)/}]},menuPlatFormList:[],showCountryList:[],lastSiteList:[],sku_list:[],formData:{automatic_guidance:"",manual_guidance:"",remarks:""},tableData:[],tableData1:[],channel:"",country:"",station:"",firstData:{},secondData:{},timelist:[],firstTableData:[],secondTableData:[],spu:"",curIndex:"",lastTable2:"",countryListIndex:"",firstIdx:"",secondIdx:"",thirdIdx:"",spuData:[],auto:"",spulist:[],curIndex1:"",rankingForm:{date:"",ranking:"",comment_amount:"",star_level:"",small_rank:""}}},computed:{curDate:function(){var t=new Date;return t.getFullYear()+"-"+(t.getMonth()+1)+"-"+t.getDate()},clientWidth:function(){return this.$store.state.clientWidth}},watch:{clientWidth:function(t){console.log("监听",t),(t<768||768==t)&&(t>400||400===t)?(console.log("大"),this.tableOne.width1="",this.tableOne.width2="",this.tableTwo.width=""):t<400||400==t?(console.log("小"),this.tableOne.width1="70",this.tableOne.width2="40",this.tableTwo.width="60"):(this.tableOne.width1="",this.tableOne.width2="",this.tableTwo.width="")}},methods:{selectSpuFun:function(t,e){this.FirstInitSpu=!1,this.selectSpu(t,e)},reFlashSpu:function(t){var e=this,a=this._url2+"server/order_management/advertising_guide/";this.$axios.get(a,{params:{country:this.country,site:this.station,auto:this.auto,spu:this.spu}}).then(function(a){console.log("新的请求数据",a),e.firstData=a.data.re_spu_data||{},console.log(e.firstData);var i={};for(var s in e.firstData)if(s===t){i=e.firstData[s];break}if(console.log("选中的表格数据",i),0===l()(i).length)return alert("数据为{}"),e.tableData=[],void(e.receptionUrl="");for(var o in i){if(!/^\d{4}-\d{2}-\d{2}$/g.test(o))return alert(i[o]),e.tableData=[],e.receptionUrl="",void console.log("跳出循环，跳出方法");var r={};for(var u in r.dates=o,console.log(i[o][0]),i[o][0]){var d=i[o][0][u];"ranking"!==u&&"small_rank"!==u&&"star_level"!==u&&"comment_amount"!==u||"string"==typeof d&&(console.log("同步值",void 0===d?"undefined":n()(d),d),d=d.replace(/^(\D*)(\d+.*)/g,"$2"),console.log("同步值",d)),r[u]=d}0===e.tableData.length&&(e.receptionUrl=r.URL),e.tableData.push(r)}})},isPhone:function(){navigator.userAgent.match(/(phone|pad|pod|iPhone|iPod|ios|iPad|Android|Mobile|BlackBerry|IEMobile|MQQBrowser|JUC|Fennec|wOSBrowser|BrowserNG|WebOS|Symbian|Windows Phone)/i)||this.$router.push("/GuidePriceedit")},showMenu:function(){this.drawerVisible=!0},skuChange:function(t){var e="";this.sku_list.forEach(function(a,i){a===t&&(e=i)}),console.log(e),this.selectSku(e,t)},goUrl:function(){""!==this.receptionUrl&&(window.location.href=this.receptionUrl)},setWidth:function(){console.log(document.body.clientWidth);var t=document.body.clientWidth;(t<768||768==t)&&(t>400||400===t)?(console.log("大"),this.tableOne.width1="",this.tableOne.width2="",this.tableTwo.width=""):t<400||400==t?(console.log("小"),this.tableOne.width1="70",this.tableOne.width2="40",this.tableTwo.width="60"):(this.tableOne.width1="",this.tableOne.width2="",this.tableTwo.width="")},submitGuidePrice:function(t){var e=this;this.$refs[t].validate(function(t){if(t){var a=e._url2+"server/order_management/advertising_guide/",i=new FormData;for(var n in i.append("site",e.station),i.append("country",e.country),i.append("spu",e.spu),i.append("auto",e.auto),e.GuiPriSupForm){var s=e.GuiPriSupForm[n];"date"===n?i.append("dates",s):i.append(n,s)}e.$axios.put(a,i).then(function(t){200===t.data.code?(e.$message.success("请求成功！"),e.dialogVisible1=!1,e.tableData=[],e.tableData1=[],console.log(e.curIndex),e.selectSku(e.curIndex)):e.$message.warning("请求未成功！")})}})},SupplementPrice:function(){this.uploadFlag&&(this.dialogVisible1=!0)},uploadRank:function(){this.uploadFlag&&(this.rankingForm.date=this.curDate,this.dialogVisible=!0)},submitRanking:function(t){var e=this;this.$refs[t].validate(function(t){if(t){var a=e._url2+"server/order_management/upload_rank/",i=new FormData;for(var n in e.rankingForm)i.append(n,e.rankingForm[n]);i.append("country",e.country),i.append("site",e.station),i.append("spu",e.spu),e.$axios.post(a,i).then(function(t){200===t.data.code?(e.$message.success(t.data.msg),e.dialogVisible=!1):e.$message.warning("请求失败")})}})},selectSpu:function(t,e){if(this.uploadFlag=!0,console.log(t,e),this.curIndex1=t,this.tableData=[],this.spu=e,console.log("当前选中auto索引",this.curIndex),console.log("选中的auto,spu",this.auto,this.spu,e),this.FirstInitSpu){var a={};for(var i in this.firstData)if(i===e){a=this.firstData[i];break}if(console.log("选中的表格数据",a),0===l()(a).length)return alert("数据为{}"),this.tableData=[],void(this.receptionUrl="");for(var s in a){if(!/^\d{4}-\d{2}-\d{2}$/g.test(s))return this.showMsg=a[s],this.tableData=[],this.receptionUrl="",void console.log("跳出循环，跳出方法");var o={};for(var r in o.dates=s,console.log(a[s][0]),a[s][0]){var u=a[s][0][r];"ranking"!==r&&"small_rank"!==r&&"star_level"!==r&&"comment_amount"!==r||"string"==typeof u&&(console.log("同步值",void 0===u?"undefined":n()(u),u),u=u.replace(/^(\D*)(\d+.*)/g,"$2"),console.log("同步值",u)),o[r]=u}0===this.tableData.length&&(this.receptionUrl=o.URL),this.tableData.push(o)}}else this.reFlashSpu(e)},handleselect:function(t){var e=t.split("-");this.thirdIdx=e.length?e[2]:"",console.log(this.thirdIdx),this.drawerVisible=!1,this.isShowSku=!0,3===e.length&&this.openSku(this.thirdIdx)},handleOpen:function(t){console.log(t);var e=t.split("-");console.log(e),this.firstIdx=e.length?e[0]:"",this.secondIdx=e.length?e[1]:"",1===e.length&&this.openStation(this.firstIdx),2===e.length&&this.openCountry(this.secondIdx)},cellStyle:function(t){t.row,t.column,t.rowIndex;var e=t.columnIndex;if(1===e||4===e)return{color:"blue"}},editSubmit:function(t){var e=this;this.spu&&this.$refs[t].validate(function(t){if(!t)return console.log("error submit!!"),!1;if(e.submitYet){if(""===e.formData.automatic_guidance&&""===e.formData.manual_guidance&&""===e.formData.remarks)return}else if(""===e.formData.automatic_guidance||""===e.formData.manual_guidance)return void alert("请输入自动组和手动组！");var a=e.tableData1.length-1;e.id=e.tableData1[a].id;var i=e._url2+"server/order_management/advertising_guide/";e.$axios.put(i,{site:e.table2_lastObj.company,country:e.table2_lastObj.countries,dates:e.date||e.table2_lastObj.times,spu:e.spu,auto:e.auto,manual_guidance:e.formData.manual_guidance,automatic_guidance:e.formData.automatic_guidance,remakes:e.formData.remarks}).then(function(t){200===t.data.code?(e.submitYet=!0,e.formData.automatic_guidance="",e.formData.manual_guidance="",e.formData.remarks="",console.log("spu值",e.spu),e.selectSku(e.curIndex)):alert("提交出现问题")})})},getMenu:function(){this.getStation()},getStation:function(){var t=this;this.menuPlatFormList=[];var e=this._url2+"server/personnel_management/get_sign_area1/";this.$axios.get(e).then(function(e){console.log(e),t.menuPlatFormList.push(e.data.data1),t.showCountryList=e.data.data||[]})},openStation:function(t){this.channel=this.menuPlatFormList[t]},openCountry:function(t){if(this.openCountryFlag&&this.station===this.showCountryList[t])return console.log("关闭"),void(this.openCountryFlag=!1);this.openCountryFlag=!0,this.station=this.showCountryList[t],this.openCountryFlag=!this.openCountryFlag,this.curIndex="",this.lastSiteList=[],this.countryListIndex=t,this.getCountry(this.station)},selectSku:function(t,e){var a=this;if(this.loading=!0,this.submitYet=!1,this.curIndex=t,this.curIndex1="",e){console.log("auto",e),this.auto=e;var i=this.spuData.find(function(t){return e===t.auto});console.log("选中的spu",i.spu),this.spulist=i.spu.split(","),console.log("spu列表",this.spulist),this.spu=this.spulist[0]}console.log("spu打印",this.spu);var n=this._url2+"server/order_management/advertising_guide/";this.$axios.get(n,{params:{country:this.country,site:this.station,auto:this.auto,spu:this.spu}}).then(function(t){if(200===t.data.code){a.loading=!1,a.secondData=t.data.re_data||{},a.firstData=t.data.re_spu_data||{},a.tableData1=[],a.tableData=[],console.log(a.secondData);var e=l()(a.secondData);if(0!==e.length){var i=e.pop();a.date=i,console.log("最后一个对象",a.secondData[i]);var n=a.secondData[i][0];for(var s in console.log("获取的最后一个对象",i),a.secondData)if(s!==i){console.log(s,i);var o={},r=a.secondData[s][0];for(var u in r)o[u]="cost_rate"!==u&&"times"!==u&&"id"!==u?Number(r[u]).toFixed(2):r[u];""===r.sales||void 0===r.sales?(o.sys_automatic_guidance="",o.sys_manual_guidance=""):(o.sys_automatic_guidance=(.01*Number(r.sales)).toFixed(2),o.sys_manual_guidance=(.1*Number(r.sales)).toFixed(2)),a.tableData1.push(o)}var d={};for(var c in n)d[c]=n[c];a.yesterday_remark=n.remakes,d.sys_automatic_guidance=(.01*Number(d.sales)).toFixed(2),d.sys_manual_guidance=(.1*Number(d.sales)).toFixed(2),a.tableData1.push(d),a.table2_lastObj=d,(null!==d.automatic_guidance&&""!==d.automatic_guidance||null!==d.manual_guidance&&""!==d.manual_guidance)&&(a.submitYet=!0)}a.FirstInitSpu=!0,a.selectSpu(0,a.spulist[0])}else alert("请求spu数据出错")})},openSku:function(t){var e=this;this.curIndex="",this.curIndex1="",this.tableData=[],this.tableData1=[],this.country=this.lastSiteList[this.secondIdx][t];var a=this._url2+"server/order_management/get_auto_data/";this.$axios.get(a,{params:{countries:this.country,company:this.station}}).then(function(t){e.sku_list=[];var a=t.data.spu_num;if(e.spuData=a||[],a.length>0)for(var i in a)e.sku_list.push(a[i].auto),"0"===i&&(e.curIndex=0,e.checkedSku=e.sku_list[0],e.selectSku(e.curIndex,e.sku_list[e.curIndex]))})},getCountry:function(t){var e=this,a=this._url2+"server/personnel_management/get_sign_country1/";this.$axios.get(a,{params:{area:t}}).then(function(t){for(var a in console.log(t),e.showCountryList)e.$set(e.lastSiteList,a,[]);200===t.data.code?e.$set(e.lastSiteList,e.countryListIndex,t.data.data):alert("请求国家失败")})}},created:function(){this.isPhone(),this.getMenu()},mounted:function(){this.setWidth()}},r={render:function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{attrs:{id:"guide-edit"}},[a("div",{staticClass:"menu"},[a("i",{staticClass:"el-icon-right",on:{click:t.showMenu}}),t._v(" "),t.isShowSku?a("div",{staticClass:"sku-list"},[a("span",[t._v("请选择sku：")]),t._v(" "),a("el-select",{attrs:{placeholder:"请选择",size:"mini"},on:{change:t.skuChange},model:{value:t.checkedSku,callback:function(e){t.checkedSku=e},expression:"checkedSku"}},t._l(t.sku_list,function(t,e){return a("el-option",{key:e,attrs:{label:t,value:t}})}),1)],1):t._e()]),t._v(" "),t.spulist.length>0?a("div",{staticClass:"spu-list"},[a("span",[t._v("spu:")]),t._v(" "),t._l(t.spulist,function(e,i){return a("span",{key:i,class:["skuSpan",{active:t.curIndex1===i}],on:{click:function(a){return t.selectSpuFun(i,e)}}},[t._v(t._s(e))])})],2):t._e(),t._v(" "),a("div",{staticClass:"table"},[a("div",{staticClass:"table-one"},[a("el-table",{directives:[{name:"loading",rawName:"v-loading",value:t.loading,expression:"loading"}],staticStyle:{width:"100%"},attrs:{"element-loading-text":"拼命加载中","element-loading-spinner":"el-icon-loading","element-loading-background":"rgba(0, 0, 0, 0.8)","max-height":"300",border:"",data:t.tableData,stripe:"",size:"mini"}},[a("el-table-column",{attrs:{align:"center",prop:"dates",label:"日期",width:t.tableOne.width}}),t._v(" "),a("el-table-column",{attrs:{align:"center",prop:"ranking",label:"大类排名",width:t.tableOne.width1}}),t._v(" "),a("el-table-column",{attrs:{align:"center",prop:"small_rank",label:"小类排名",width:t.tableOne.width1}}),t._v(" "),a("el-table-column",{attrs:{align:"center",prop:"inventory",label:"库存",width:t.tableOne.width2}}),t._v(" "),a("el-table-column",{attrs:{align:"center",prop:"comment_amount",label:"评分数量",width:t.tableOne.width1}}),t._v(" "),a("el-table-column",{attrs:{align:"center",prop:"star_level",label:"评分",width:t.tableOne.width2}})],1),t._v(" "),a("div",{staticClass:"table-button"},[a("el-button",{attrs:{type:"primary",size:"mini"},on:{click:t.uploadRank}},[t._v("上传排名")]),t._v(" "),a("el-button",{attrs:{type:"primary",size:"mini"},on:{click:t.goUrl}},[t._v("前台网址")])],1)],1),t._v(" "),a("div",{staticClass:"table-two"},[a("el-table",{directives:[{name:"loading",rawName:"v-loading",value:t.loading,expression:"loading"}],staticStyle:{width:"100%"},attrs:{stripe:"","element-loading-text":"拼命加载中","element-loading-spinner":"el-icon-loading","element-loading-background":"rgba(0, 0, 0, 0.8)","max-height":"400","cell-style":t.cellStyle,data:t.tableData1,border:"",size:"mini"}},[a("el-table-column",{attrs:{align:"center",prop:"times",label:"日期",fixed:"left"}}),t._v(" "),a("el-table-column",{attrs:{align:"center",prop:"automatic_guidance",label:"实际指导价(自动)",width:t.tableTwo.width}}),t._v(" "),a("el-table-column",{attrs:{align:"center",prop:"sys_automatic_guidance",label:"系统指导价(自动)",width:t.tableTwo.width}}),t._v(" "),a("el-table-column",{attrs:{align:"center",prop:"auto_ad_cost",label:"实际花费(自动)",width:t.tableTwo.width}}),t._v(" "),a("el-table-column",{attrs:{align:"center",prop:"manual_guidance",label:"实际指导价(手动)",width:t.tableTwo.width}}),t._v(" "),a("el-table-column",{attrs:{align:"center",prop:"sys_manual_guidance",label:"系统指导价(手动)",width:t.tableTwo.width}}),t._v(" "),a("el-table-column",{attrs:{align:"center",prop:"no_auto_ad_cost",label:"实际花费(手动)",width:t.tableTwo.width}}),t._v(" "),a("el-table-column",{attrs:{align:"center",prop:"cost_rate",label:"广告比",width:t.tableTwo.width}})],1)],1)]),t._v(" "),a("div",{staticClass:"remark"},[a("div",{staticClass:"title"},[a("span",[t._v("备注相关"+t._s(t.yesterday_remark))])]),t._v(" "),a("div",{staticClass:"editBox"},[a("el-form",{ref:"guidepriceform",attrs:{model:t.formData,rules:t.rules,inline:!0}},[a("el-form-item",{staticStyle:{display:"block"}},[a("el-date-picker",{attrs:{"picker-options":t.disableOpt,type:"date",placeholder:"选择日期","value-format":"yyyy-MM-dd"},model:{value:t.date,callback:function(e){t.date=e},expression:"date"}})],1),t._v(" "),a("div",{staticClass:"remark-inline"},[a("el-form-Item",{attrs:{prop:"automatic_guidance",label:"自动组"}},[a("el-input",{model:{value:t.formData.automatic_guidance,callback:function(e){t.$set(t.formData,"automatic_guidance",e)},expression:"formData.automatic_guidance"}})],1),t._v(" "),a("el-form-Item",{attrs:{prop:"manual_guidance",label:"手动组"}},[a("el-input",{model:{value:t.formData.manual_guidance,callback:function(e){t.$set(t.formData,"manual_guidance",e)},expression:"formData.manual_guidance"}})],1)],1),t._v(" "),a("div",{staticClass:"remark-width"},[a("el-form-item",{staticStyle:{width:"100%"},attrs:{prop:"remarks",label:"备注"}},[a("el-input",{staticClass:"remarkDiv",attrs:{type:"textarea"},model:{value:t.formData.remarks,callback:function(e){t.$set(t.formData,"remarks",e)},expression:"formData.remarks"}})],1)],1),t._v(" "),a("el-form-item",{staticStyle:{display:"block"}},[a("el-button",{staticClass:"lastBtn",attrs:{type:"primary",size:"mini"},on:{click:function(e){return t.editSubmit("guidepriceform")}}},[t._v("确定")])],1)],1)],1)]),t._v(" "),a("el-drawer",{attrs:{title:"同步广告指导",visible:t.drawerVisible,direction:"ltr",size:"60%","show-close":!1,"custom-class":"drawer"},on:{"update:visible":function(e){t.drawerVisible=e}}},[a("el-menu",{staticClass:"el-menu-vertical-demo leftMenuBar",attrs:{"unique-opened":""},on:{open:t.handleOpen,select:t.handleselect}},t._l(t.menuPlatFormList,function(e,i){return a("el-submenu",{key:i,attrs:{index:i+""}},[a("template",{slot:"title"},[a("span",{staticStyle:{display:"inline-block",width:"100%"}},[t._v(t._s(e))])]),t._v(" "),t._l(t.showCountryList,function(e,n){return a("el-submenu",{key:n,attrs:{index:i+"-"+n}},[a("template",{slot:"title"},[a("span",{staticStyle:{display:"inline-block",width:"100%"}},[t._v(t._s(e))])]),t._v(" "),t._l(t.lastSiteList[n],function(e,s){return a("el-menu-item",{key:s,attrs:{index:i+"-"+n+"-"+s}},[a("span",{staticStyle:{display:"inline-block",width:"100%"}},[t._v(t._s(e))])])})],2)})],2)}),1)],1),t._v(" "),a("el-dialog",{attrs:{title:"上传排名",visible:t.dialogVisible,width:"100%",center:""},on:{"update:visible":function(e){t.dialogVisible=e}}},[a("div",{staticClass:"form-con"},[a("el-form",{ref:"rankingForm",attrs:{rules:t.rulesUL,model:t.rankingForm}},[a("el-form-item",{attrs:{prop:"date",label:"日期"}},[a("el-date-picker",{attrs:{type:"date","value-format":"yyyy-MM-dd",placeholder:"选择日期"},model:{value:t.rankingForm.date,callback:function(e){t.$set(t.rankingForm,"date",e)},expression:"rankingForm.date"}})],1),t._v(" "),a("el-form-item",{attrs:{prop:"ranking",label:"大类排名"}},[a("el-input",{model:{value:t.rankingForm.ranking,callback:function(e){t.$set(t.rankingForm,"ranking",e)},expression:"rankingForm.ranking"}})],1),t._v(" "),a("el-form-item",{attrs:{prop:"small_rank",label:"小类排名"}},[a("el-input",{model:{value:t.rankingForm.small_rank,callback:function(e){t.$set(t.rankingForm,"small_rank",e)},expression:"rankingForm.small_rank"}})],1),t._v(" "),a("el-form-item",{attrs:{prop:"comment_amount",label:"评分数量"}},[a("el-input",{model:{value:t.rankingForm.comment_amount,callback:function(e){t.$set(t.rankingForm,"comment_amount",e)},expression:"rankingForm.comment_amount"}})],1),t._v(" "),a("el-form-item",{attrs:{prop:"star_level",label:"评分"}},[a("el-input",{model:{value:t.rankingForm.star_level,callback:function(e){t.$set(t.rankingForm,"star_level",e)},expression:"rankingForm.star_level"}})],1)],1)],1),t._v(" "),a("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[a("el-button",{on:{click:function(e){t.dialogVisible=!1}}},[t._v("取 消")]),t._v(" "),a("el-button",{attrs:{type:"primary"},on:{click:function(e){return t.submitRanking("rankingForm")}}},[t._v("确 定")])],1)])],1)},staticRenderFns:[]};var u=a("VU/8")(o,r,!1,function(t){a("DfM1"),a("gQpg")},"data-v-60377524",null);e.default=u.exports},gQpg:function(t,e){}});
//# sourceMappingURL=34.7b7c662d1bdbe4129e36.js.map
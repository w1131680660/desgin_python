webpackJsonp([44],{"8Sl3":function(e,t){},I053:function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=r("BO1k"),o=r.n(i),a={name:"",props:{},components:{orderNav:r("uuOi").a},data:function(){return{queryInfo:{form:{checkedDpm:"",checkedStaff:"",checkedType:"",checkedDate:""},departmentList:[],staff:[],type:["即时","远期"]},orderGatherList:[],checkedList:[],indexList:[],editOrderDialog:{dialogVisible:!1,editForm:{cutOffTime:"",contentInfo:"",followInfo:"",jobId:"",receivePerson:"",issuingTime:""}},orderSubmitDialog:{dialogVisible:!1,form:{type:"",contentInfo:"",cutOffTime:"",department:"",staff:""}},formRules:{contentInfo:[{required:!0,message:"请填写内容需求",trigger:"blur"}],followInfo:[{required:!0,message:"请填写跟进信息",trigger:"blur"}],cutOffTime:[{type:"string",required:!0,message:"请选择日期",trigger:"change"}],department:[{type:"string",required:!0,message:"请选择接单部门",trigger:"change"}],staff:[{type:"string",required:!0,message:"请选择接单人",trigger:"change"}],type:[{required:!0,message:"请选择工单类型",trigger:"change"}]},selection:[],selectNum:0}},computed:{},watch:{},methods:{getOrderList:function(){var e=this,t=this.queryInfo.form;this.$api.queryInfo(t).then(function(t){console.log(t),e.orderGatherList=t.data.data})},getOrderSelectData:function(){var e=this;this.$api.getOrderSelectData().then(function(t){console.log(t),e.queryInfo.departmentList=t.data.data})},operateClick:function(e){var t=this;if("工单提交申请"!=e.target.innerText){if(0==this.selectNum)return this.$message.error("请选择一个工单");if("编辑"==e.target.innerText){if(this.selectNum>1)return this.$message.error("只可以编辑一个工单");var r=this.editOrderDialog.editForm;r.receivePerson=this.selection[0].initiate_person,r.issuingTime=this.selection[0].initiate_time,r.cutOffTime=this.selection[0].out_time,r.contentInfo=this.selection[0].need,r.followInfo=this.selection[0].next_info,r.jobId=this.selection[0].id,this.editOrderDialog.dialogVisible=!0}else if("删除"==e.target.innerText)this.$confirm("此操作将永久删除工单, 是否继续?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(function(){var e=[],r=!0,i=!1,a=void 0;try{for(var n,l=o()(t.selection);!(r=(n=l.next()).done);r=!0){var s=n.value;e.push(s.id)}}catch(e){i=!0,a=e}finally{try{!r&&l.return&&l.return()}finally{if(i)throw a}}console.log(e),t.$api.removeOrder(e).then(function(e){console.log(e),t.getOrderList(),t.$message.success("删除工单成功")})}).catch(function(){});else if("置顶"==e.target.innerText){for(var i in this.indexList){var a=this.orderGatherList[this.indexList[i]];this.orderGatherList.splice(this.indexList[i],1),this.orderGatherList.unshift(a)}for(var n in this.checkedList)this.$set(this.checkedList,n,!1)}}},handleSelectionChange:function(e){this.selection=e,this.selectNum=e.length},orderSubmitClick:function(){this.orderSubmitDialog.dialogVisible=!0},orderSubmitConfirm:function(){var e=this;this.$refs.orderSubmitRef.validate(function(t){if(t){console.log(e.orderSubmitDialog.form);var r=new FormData;r.append("receive_department",e.orderSubmitDialog.form.department),r.append("receive_person",e.orderSubmitDialog.form.staff),r.append("job_type",e.orderSubmitDialog.form.type),r.append("out_time",e.orderSubmitDialog.form.cutOffTime),r.append("need",e.orderSubmitDialog.form.contentInfo),r.append("user_name",e.$store.state.userName),e.$api.orderSubmit(r).then(function(t){t&&(console.log(t),e.getOrderList(),e.getOrderSelectData(),e.$message.success("添加工单成功"),e.orderSubmitDialog.dialogVisible=!1)})}})},editOrderConfirm:function(){var e=this;this.$refs.editOrderRef.validate(function(t){if(t){var r=new FormData;r.append("job_id",e.editOrderDialog.editForm.jobId),r.append("out_time",e.editOrderDialog.editForm.cutOffTime),r.append("need",e.editOrderDialog.editForm.contentInfo),r.append("next_info",e.editOrderDialog.editForm.followInfo),r.append("user_name",e.$store.state.userName),e.$api.editOrder(r).then(function(t){console.log(t),e.getOrderList(),e.$message.success("编辑工单成功"),e.editOrderDialog.dialogVisible=!1})}})},departmentChange:function(e){var t=this;this.$api.getReceivePerson(e).then(function(e){console.log(e),t.queryInfo.staff=e.data.data})},queryOrder:function(){this.getOrderList()},jiedanConfirm:function(e){var t=this;console.log(e),this.$confirm("确认要结单吗？",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(function(){t.$api.jiedanConfirm(e).then(function(e){console.log(e),t.$message.success("结单成功"),t.getOrderList()})}).catch(function(){})},jiedanReject:function(e){var t=this;this.$confirm("确认要驳回吗？",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(function(){t.$api.jiedanReject(e).then(function(e){console.log(e),t.$message.success("驳回成功"),t.getOrderList()})}).catch(function(){})},orderSubmitDialogClose:function(){this.$refs.orderSubmitRef.resetFields()},editOrderDialogClose:function(){this.$refs.editOrderRef.resetFields()}},created:function(){this.getOrderList(),this.getOrderSelectData()},mounted:function(){}},n={render:function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("div",{attrs:{id:"order-submited"}},[r("order-nav"),e._v(" "),r("h3",[e._v("已提交工单")]),e._v(" "),r("div",{staticClass:"order_query"},[r("div",{staticClass:"left"},[r("div",{staticClass:"select"},[r("span",[e._v("结单部门")]),e._v(" "),r("el-select",{attrs:{placeholder:"请选择",clearable:""},on:{change:e.departmentChange},model:{value:e.queryInfo.form.checkedDpm,callback:function(t){e.$set(e.queryInfo.form,"checkedDpm",t)},expression:"queryInfo.form.checkedDpm"}},e._l(e.queryInfo.departmentList,function(e,t){return r("el-option",{key:t,attrs:{label:e,value:e}})}),1)],1),e._v(" "),r("div",{staticClass:"select"},[r("span",[e._v("接单人")]),e._v(" "),r("el-select",{attrs:{placeholder:"请选择",clearable:""},model:{value:e.queryInfo.form.checkedStaff,callback:function(t){e.$set(e.queryInfo.form,"checkedStaff",t)},expression:"queryInfo.form.checkedStaff"}},e._l(e.queryInfo.staff,function(e,t){return r("el-option",{key:t,attrs:{label:e,value:e}})}),1)],1),e._v(" "),r("div",{staticClass:"select"},[r("span",[e._v("工单类型")]),e._v(" "),r("el-select",{attrs:{placeholder:"请选择",clearable:""},model:{value:e.queryInfo.form.checkedType,callback:function(t){e.$set(e.queryInfo.form,"checkedType",t)},expression:"queryInfo.form.checkedType"}},e._l(e.queryInfo.type,function(e,t){return r("el-option",{key:t,attrs:{label:e,value:e}})}),1)],1),e._v(" "),r("div",{staticClass:"select"},[r("span",[e._v("结单时间")]),e._v(" "),r("el-date-picker",{attrs:{type:"date",placeholder:"选择日期",format:"yyyy/MM/dd","value-format":"yyyy/MM/dd"},model:{value:e.queryInfo.form.checkedDate,callback:function(t){e.$set(e.queryInfo.form,"checkedDate",t)},expression:"queryInfo.form.checkedDate"}})],1)]),e._v(" "),r("div",{staticClass:"right"},[r("el-button",{attrs:{type:"primary",size:"small"},on:{click:e.queryOrder}},[e._v("查询")])],1)]),e._v(" "),r("div",{staticClass:"order_table"},[r("div",{staticClass:"operate",on:{click:e.operateClick}},[r("el-button",{attrs:{type:"primary",size:"mini"}},[e._v("编辑")]),e._v(" "),r("el-button",{attrs:{type:"danger",size:"mini"}},[e._v("删除")]),e._v(" "),r("el-button",{attrs:{type:"primary",size:"mini"},on:{click:e.orderSubmitClick}},[e._v("工单提交申请")])],1),e._v(" "),r("div",{staticClass:"table_container"},[r("el-table",{staticStyle:{width:"100%"},attrs:{data:e.orderGatherList,border:"","max-height":"500",size:"small"},on:{"selection-change":e.handleSelectionChange}},[r("el-table-column",{attrs:{type:"selection"}}),e._v(" "),r("el-table-column",{attrs:{type:"index",label:"序号",width:"60"}}),e._v(" "),r("el-table-column",{attrs:{prop:"receive_person",label:"接单人"}}),e._v(" "),r("el-table-column",{attrs:{prop:"initiate_time",label:"发单时间"}}),e._v(" "),r("el-table-column",{attrs:{prop:"out_time",label:"结单时间"}}),e._v(" "),r("el-table-column",{attrs:{prop:"need",label:"内容需求"}}),e._v(" "),r("el-table-column",{attrs:{prop:"next_info",label:"跟进信息"}}),e._v(" "),r("el-table-column",{attrs:{prop:"job_type",label:"工单类型"}}),e._v(" "),r("el-table-column",{attrs:{prop:"status",label:"状态"}}),e._v(" "),r("el-table-column",{attrs:{label:"操作",width:"180"},scopedSlots:e._u([{key:"default",fn:function(t){var i=t.row;return["结单中"==i.status?r("div",[r("el-button",{attrs:{type:"primary",size:"mini"},on:{click:function(t){return e.jiedanConfirm(i.id)}}},[e._v("结单确认")]),e._v(" "),r("el-button",{attrs:{type:"danger",size:"mini"},on:{click:function(t){return e.jiedanReject(i.id)}}},[e._v("驳回")])],1):e._e()]}}])})],1)],1)]),e._v(" "),r("el-dialog",{attrs:{title:"提示",visible:e.editOrderDialog.dialogVisible,width:"30%",center:"","close-on-click-modal":!1,"close-on-press-escape":!1},on:{"update:visible":function(t){return e.$set(e.editOrderDialog,"dialogVisible",t)},close:e.editOrderDialogClose}},[r("el-form",{ref:"editOrderRef",attrs:{model:e.editOrderDialog.editForm,rules:e.formRules,"label-width":"100px"}},[r("el-form-item",{attrs:{label:"接单人"}},[r("el-input",{attrs:{readonly:""},model:{value:e.editOrderDialog.editForm.receivePerson,callback:function(t){e.$set(e.editOrderDialog.editForm,"receivePerson",t)},expression:"editOrderDialog.editForm.receivePerson"}})],1),e._v(" "),r("el-form-item",{attrs:{label:"发单时间"}},[r("el-input",{attrs:{readonly:""},model:{value:e.editOrderDialog.editForm.issuingTime,callback:function(t){e.$set(e.editOrderDialog.editForm,"issuingTime",t)},expression:"editOrderDialog.editForm.issuingTime"}})],1),e._v(" "),r("el-form-item",{attrs:{label:"截单时间",prop:"cutOffTime"}},[r("el-date-picker",{attrs:{type:"datetime",placeholder:"选择日期",format:"yyyy/MM/dd HH:mm","value-format":"yyyy/MM/dd HH:mm"},model:{value:e.editOrderDialog.editForm.cutOffTime,callback:function(t){e.$set(e.editOrderDialog.editForm,"cutOffTime",t)},expression:"editOrderDialog.editForm.cutOffTime"}})],1),e._v(" "),r("el-form-item",{attrs:{label:"内容需求",prop:"contentInfo"}},[r("el-input",{attrs:{type:"textarea"},model:{value:e.editOrderDialog.editForm.contentInfo,callback:function(t){e.$set(e.editOrderDialog.editForm,"contentInfo",t)},expression:"editOrderDialog.editForm.contentInfo"}})],1),e._v(" "),r("el-form-item",{attrs:{label:"跟进信息",prop:"followInfo"}},[r("el-input",{attrs:{type:"textarea"},model:{value:e.editOrderDialog.editForm.followInfo,callback:function(t){e.$set(e.editOrderDialog.editForm,"followInfo",t)},expression:"editOrderDialog.editForm.followInfo"}})],1)],1),e._v(" "),r("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[r("el-button",{attrs:{type:"primary"},on:{click:e.editOrderConfirm}},[e._v("确 认")])],1)],1),e._v(" "),r("el-dialog",{attrs:{title:"工单提交申请",visible:e.orderSubmitDialog.dialogVisible,width:"30%",center:"","close-on-click-modal":!1,"close-on-press-escape":!1},on:{"update:visible":function(t){return e.$set(e.orderSubmitDialog,"dialogVisible",t)},close:e.orderSubmitDialogClose}},[r("el-form",{ref:"orderSubmitRef",attrs:{model:e.orderSubmitDialog.form,rules:e.formRules,"label-width":"100px"}},[r("el-form-item",{attrs:{label:"接单部门",prop:"department"}},[r("el-select",{attrs:{placeholder:"请选择"},on:{change:e.departmentChange},model:{value:e.orderSubmitDialog.form.department,callback:function(t){e.$set(e.orderSubmitDialog.form,"department",t)},expression:"orderSubmitDialog.form.department"}},e._l(e.queryInfo.departmentList,function(e,t){return r("el-option",{key:t,attrs:{label:e,value:e}})}),1)],1),e._v(" "),r("el-form-item",{attrs:{label:"接单人",prop:"staff"}},[r("el-select",{attrs:{placeholder:"请选择"},model:{value:e.orderSubmitDialog.form.staff,callback:function(t){e.$set(e.orderSubmitDialog.form,"staff",t)},expression:"orderSubmitDialog.form.staff"}},e._l(e.queryInfo.staff,function(e,t){return r("el-option",{key:t,attrs:{label:e,value:e}})}),1)],1),e._v(" "),r("el-form-item",{attrs:{label:"工单类型",prop:"type"}},[r("el-select",{attrs:{placeholder:"请选择"},model:{value:e.orderSubmitDialog.form.type,callback:function(t){e.$set(e.orderSubmitDialog.form,"type",t)},expression:"orderSubmitDialog.form.type"}},e._l(e.queryInfo.type,function(e,t){return r("el-option",{key:t,attrs:{label:e,value:e}})}),1)],1),e._v(" "),r("el-form-item",{attrs:{label:"截单时间",prop:"cutOffTime"}},[r("el-date-picker",{attrs:{type:"datetime",placeholder:"选择日期",format:"yyyy/MM/dd HH:mm","value-format":"yyyy/MM/dd HH:mm"},model:{value:e.orderSubmitDialog.form.cutOffTime,callback:function(t){e.$set(e.orderSubmitDialog.form,"cutOffTime",t)},expression:"orderSubmitDialog.form.cutOffTime"}})],1),e._v(" "),r("el-form-item",{attrs:{label:"内容需求",prop:"contentInfo"}},[r("el-input",{attrs:{type:"textarea"},model:{value:e.orderSubmitDialog.form.contentInfo,callback:function(t){e.$set(e.orderSubmitDialog.form,"contentInfo",t)},expression:"orderSubmitDialog.form.contentInfo"}})],1)],1),e._v(" "),r("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[r("el-button",{attrs:{type:"primary"},on:{click:e.orderSubmitConfirm}},[e._v("确 定")])],1)],1)],1)},staticRenderFns:[]};var l=r("VU/8")(a,n,!1,function(e){r("8Sl3"),r("tKeX")},"data-v-2c7d117f",null);t.default=l.exports},tKeX:function(e,t){}});
//# sourceMappingURL=44.668ee73cbe6bf0a4a8ba.js.map